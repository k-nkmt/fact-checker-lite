# Fact-Cheker 解説
以下は公開日(2025-05-31)時点のものになります。更新により変わっている可能性があることにはご注意ください。

## 概要
誤情報が拡散されてしまうことを防ぐためのアラート用のシステムです。
現在のチェックの対象はX(旧Twitter)で、マニフェストを記載したマークダウン形式の文書などあらかじめ読み込んだ文書ファイルを元に、感想／意見など主観的なものは除いた、客観的で検証可能な投稿の内容について、データソースと矛盾（誤りがある）がある場合にはSlackに通知を出す、という動作になっています。  

### AI関連の仕様
使用するサービスにはOpenAI社が選択されており、モデルはo3-miniが指定されています。  
いわゆるRAG(Retrieval-Augmented Generation)と呼ばれる、外部の信頼できる情報を参照することで、AIによる誤情報(ハルシネーション)の影響を低減してより正確で最新の情報に基づいた回答がされます。
プロンプトから判断するところでは、検閲のようなことは意図されておらず、あくまで情報源とする文書ファイルとの整合性を確認する、という動作であることから、情報源となる文書の内容の影響を受ける部分はあるものの、公平性については高いといえるかと思います。  
RAGの仕組み上、含まれる単語や表現により本来参照したい情報を適切に取得できなかった場合には、適切な回答とならない可能性はあります。  
またそもそも情報源とする文書ファイルに含まれない情報については、適切な回答とならない可能性があります。

チームみらいの場合は[マニフェスト](https://github.com/team-mirai/policy)のファイルをOpenAIにアップロードして参照するようになっています。  

OpenAI社では、意味的に類似する参考資料を参考に回答させるのに必要となるベクトルストアのサービスも提供しており、シンプルにシステムを実装できることが採用の要因になっているかと思います。

### ライセンス
AGPLライセンスとなっています。
そのためコードを改変して利用する際には、改変したコードを配布する場合に加えて、Webサービスとして公開する場合にもコードの公開義務があります。  
現状ではコードのうちX(旧Twitter)の条件等を変える必要があり、基本的に使用する際は変更したものを公開する必要がありそうです。

### 実行環境
honoという Node.js, Deno, Bunといった主要なJavaScriptランタイムで動作するWEBフレームワークが使用されています。  
ローカルに開発環境を準備したり、node.jsに対応しているような一般的なクラウドサービスであれば、実行することができます。  

AIの部分についてローカルで簡易的に動作を試してみたい、というような方は、pythonとjupyter notebookのみで実行可能な[fact-checker-lite.ipynb](fact-checker-lite.ipynb)を使用してみてください。

## カスタマイズ
他の政党、政治家による利用も想定されていますが、現在は使用するにあたりID・パスワード的なもの以外でも一部カスタマイズが必要な部分があります。
IssueやPull requestは作成されているので、そちらも適宜確認しておくことをおすすめします。

### X(旧Twitter)の検索対象
https://github.com/team-mirai-volunteer/fact-checker/blob/506d009e5bd5703531435a89dbca6ec35401b6a0/src/index.ts#L73 で検索条件が指定されています。  
基本的には変更が必須です。  
またこの部分を参考に追加・修正すればX以外のSNSをチェックすることも可能です。  

こちらは変更が必要ではありませんが、Slackへの通知テストを任意の文章で行いたい場合にはhttps://github.com/team-mirai-volunteer/fact-checker/blob/506d009e5bd5703531435a89dbca6ec35401b6a0/src/index.ts#L44 の部分も変更しておくといいかと思います。

### 参照する情報
scripts/upload.tsを実行すると、policyフォルダのマークダウンファイルをOpenAIにアップロードするようになっています。
参照先や対象を変更するか、scripts/upload.tsは実行せずにOpenAI側でファイルのアップロードを行い、適宜vector store IDを指定することでも対応可能です。

### モデルとプロンプト
こちらは必須ではなく好みになりますが、
https://github.com/team-mirai-volunteer/fact-checker/blob/506d009e5bd5703531435a89dbca6ec35401b6a0/src/lib/fact-check.ts#L20 に指定があります。
使用されているResponse APIは新しい新しい仕様のAPIで、これまで広く使われているChat Completion APIとは互換性はありません。  
OpenAI社以外のモデルを使用したい場合には、langchain等のライブラリを使用するなどの対応が必要になります。